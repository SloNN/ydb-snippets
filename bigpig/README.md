# Запуск сервиса YDB на одной машине с большим количеством ресурсов

Для подготовки к запуску необходимо скачать YDB по [инструкции Quickstart из документации](https://ydb.tech/ru/docs/getting_started/quickstart), но пока не запускать сервис.

Предполагается наличие значительных вычислительных ресурсов (от 32 vCPU и 64 Гбайт оперативной памяти), а также высоко-производительного устройства ввода-вывода (блочное устройство без файловой системы).

В выбранный для работы YDB каталог необходимо поместить следующие файлы:

* `start-pig.sh` - шаблон скрипта для запуска сервисов YDB;
* `config/pig-static.yaml` - конфигурационный файл для запуска статического узла;
* `config/pig-dynamic.yaml` - конфигурационный файл для запуска динамических узлов.

В скрипте `start-pig.sh` нужно поправить имя устройства для хранения данных (переменная `disk`) и списки процессорных ядер для привязки процессов YDB (переменные `ZONES_DYNAMIC`, `ZONE_STATIC`).

Номера ядер для запуска каждого процесса YDB указываются в переменных `ZONES_DYNAMIC`, `ZONE_STATIC`, разделитель - пробел. Количество запускаемых динамических узлов YDB соответствует количеству элементов в списке `ZONES_DYNAMIC`.

Диапазоны номеров процессорных ядер не должны пересекаться, каждый из диапазонов должен укладываться в границы одной NUMA-ноды (можно посмотреть через `lscpu`).

Конфигурация расчитана на 16 vCPU в каждом процессе. Размер кеша данных установлен в 16 Гбайт на процесс.

# Подключение к сервису YDB с других серверов

По умолчанию запускаемый сервис YDB настроен для обслуживания только локальных подключений (используется сетевой адрес `127.0.0.1`).

Если требуется обеспечить доступ к сервису YDB через сеть с других серверов, необходимо изменить следующие параметры:
* изменить сетевой адрес, указанный в секции `grpc_config` в файлах `config/pig-*.yaml`;
* заменить вхождения `localhost` на необходимый сетевой адрес в шаблоне скрипта запуска `start-pig.sh`.

# Производительность ввода-вывода и дисковые группы

Предложенный пример скрипта `start-pig.sh` создает 5 дисковых групп (с помощью команды `ydbd admin database /Root/test create ssd:5`).

Если используется очень быстрое устройство ввода-вывода, то количество дисковых групп можно увеличить до 8 или 9.

Для увеличения количества дисковых групп можно использовать утилиту `ydb-dstool`, как [описано в документации](https://ydb.tech/ru/docs/maintenance/manual/adding_storage_groups). В некоторых случаях перед добавлением дисковых групп требуется вернуть объект PDisk в активное состояние [в соответствии с инструкцией](https://ydb.tech/ru/docs/maintenance/manual/moving_vdisks#return_a_device_to_work).
